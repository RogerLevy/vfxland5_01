require %idir%/checks.vfx
require %idir%/tilemap2.vfx
require %idir%/actor.vfx

\ =============================================================================
\ Detect tiles under rectangle
\ =============================================================================


|| 0 value a
|| 0 value lx 0 value ly
|| 0 value lw 0 value lh
|| 0 value lx2 0 value ly2
|| 0 value xt

|| : pen-colrow  at@ xgap ygap 2/ ;

continuation: tread> ( x y w h a - code ; ) ( pen=xy a - )
    to xt  to a  to lh to lw to ly to lx 
    x @ >i lx + dup to lx  lw + 1 - to lx2 
    y @ >i ly + dup to ly  lh + 1 - to ly2
    ly2 ygap + ly do
        lx2 xgap + lx do
            i lx2 min j ly2 min at  pen-colrow a spot xt execute
            me free? if unloop unloop exit then
        xgap +loop
    ygap +loop ;
