1 constant SCENE_FORMAT_VERSION

class: actor
    prop owner <ref actor       \ actors with owners are discarded
                                \ it is up to the owner actor to recreate
class;

: own ( actor - actor )
    me over -> owner ! ;

class: scene  
    is-a _totem
    extension: scn
    default-dir: dat/scn
class;

: deser-actor ( a - a' )
    ['] one desbin+ ;

actor :: serializable? ( - flag )
    en @   owner @ 0= and ; 

scene :: _keep ( - )
    \ save actors on stage to disk
    build[ 
        SCENE_FORMAT_VERSION ,
        me serbin,
        actors ['] serializable? ['] serbin, sermulti,
    build] srcpath$ count write ;

: actor-instance ( class - actor )
    dup actor is? not if
        body> >name count
        f" Class %s does not inherit from ACTOR." -1 -rot .abort 
    then 
    one ;

: deser-actors+ ( a - a' ) 
    ['] actor-instance ['] desbin+ desmulti+ ;

: deser-scene+ ( a - a' )
    @+ SCENE_FORMAT_VERSION check-version
    ['] into-me desbin+ ;

scene :: load ( - )
    \ load actors from disk to stage
    src> deser-scene+ deser-actors+ ;

scene :: _intake ( - )
    src> deser-scene+ ;

: +scene ( <name> - scene ) 
    scene +totem ;