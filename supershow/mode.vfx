class: %mode
    prop drw :xt
    prop beha :xt
class;

%mode object default-mode 
variable gamemode  default-mode gamemode !
|| variable catchup

: process-work ( - )
    gamemode @ -> beha @ process-tick ;

: process-show ( - )
    gamemode @ -> drw @ ?execute ;

: supershow ( - )
    catchup @ if catchup off  process-work then
    [: process-work process-show ;] time-xt n>f 
    1e tps f/ 1000000e f* f>= if \ frame took more than a system tick
        1 catchup ! \ process the game logic an extra time after presenting
    then ;

: work> ( <code;> - )
    r> gamemode @ -> beha ! show> supershow ;

redef : show> ( <code;> - )
    r> gamemode @ -> drw ! show> supershow ;
