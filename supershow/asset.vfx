trait: %autoload
    :: on-startup ( - ) ;
trait;

create autoloads /list allot&erase 

: load-autoloads ( - )
    autoloads list-count for
        list-next on-startup
    loop drop ;

class: %asset
    is-a %autoload
    256 nprop srcpath$ <cstring
    prop data 

    : embed ( fp len - )
        2dup lslurp data !  srcpath$ place ;

    : asset ( fp len class - asset ) ( - asset )
        >r 
        2dup -path 
        r> -rot $object { embed me } 
        dup autoloads add-to ;

    : data@ ( asset - a len )
        -> data @ lcount ;

class;

: memfile@ ( a len - ALLEGRO_FILE_fp )
    0 z" r" al_open_memfile ;

: -memfile ( ALLEGRO_FILE_fp - )
    al_fclose drop ;