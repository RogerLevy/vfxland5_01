\ ------------------------------------------------------------------------------
\ Supershow
\
\ minimal engine with actors, VGA colors, CRT effect,
\ sample playback, and tilemaps.
\ ------------------------------------------------------------------------------

\ =============================================================================
\ Validations
\ =============================================================================

include %idir%\checks.vfx

\ =============================================================================
\ Constants and Variables
\ =============================================================================

20 ?constant gap  
320 gap / ?constant tmw
240 gap / ?constant tmh

\ =============================================================================
\ Dependencies
\ =============================================================================

include %idir%\..\lib\array2.vfx  \ Array support
include %idir%\shader.vfx    \ Shaders 
include %idir%\crt.vfx       \ CRT shader
include %idir%\waveplay.vfx  \ Audio engine
include %idir%\utilities.vfx \ Math helpers, audio, and misc utilities

\ =============================================================================
\ Stage
\ =============================================================================

include %idir%\stage.vfx     \ Actor/sprite system
include %idir%\traits.vfx    \ Object traits
include %idir%\scene.vfx     \ Scene management
include %idir%\autoclass.vfx \ Auto-generate classes from bitmaps

\ =============================================================================
\ Tilemap
\ =============================================================================

include %idir%\tilemap.vfx  \ Tilemap rendering Tileset class
include %idir%\udlr.vfx     \ Movement utilities
include %idir%\tmcol.vfx    \ Tilemap collision detection
include %idir%\tread.vfx    \ Tilemap data reading
include %idir%\sprite.vfx   \ Sprite animation (depends on tilesets)

\ =============================================================================
\ Automatically refresh bitmaps and tilesets
\ =============================================================================

: reload-graphics
    cr ." Reloading graphics..."
    reload-bitmaps
    reload-tilesets ;

\ =============================================================================
\ Initialization
\ =============================================================================

: init-supershow ( - )
    hold off
    init-tilesets
    load-samples
    init-crt
    debug @ if
        ['] reload-graphics is onSwitchIn
    else
        display al_hide_mouse_cursor
    then ;


debug @ [if]
    include %idir%/tools.vfx           \ Development tools
    include %idir%/tools/sketchpad.vfx \ Graphics editor
[then]
