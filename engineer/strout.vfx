|| 4 constant #buffers
|| 32768 constant /buffer
|| create buffers #buffers /buffer * allot&erase
|| variable buffer-index

: reset-strout-buffers ( - )
    0 buffer-index !
    buffers #buffers /buffer * erase ;

|| : str ( - a )
    buffer-index @ /buffer * buffers + ;

|| : buf+ ( - )
    buffer-index @ 1 + #buffers umod buffer-index !
    s" " str wplace ;

|| : buf- ( - )
    buffer-index @ 1 - #buffers umod buffer-index ! ;

|| variable cbuf
|| : Emit-string  drop  cbuf c!  cbuf 1 str wappend ;
|| : Type-string  drop  bounds ?do  i c@ 0 emit-string  loop ;
|| : CR-string    drop  10 0 emit-string ;
|| create string-vectors
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' Emit-string ,
  ' drop ,
  ' Type-string ,
  ' CR-string ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,
  ' drop ,


|| : pagealign ( - )  here $ff and 256 swap - allot ;
|| : aligned-page ( - <name> )  pagealign here $100 allot&erase constant ;
|| aligned-page strout-stack
|| variable ssp   strout-stack ssp ! 
|| : strout-push ( ? - ) ssp @ !  4 ssp c+! ;
|| : strout-pop ( - ? ) -4 ssp c+!  ssp @ @ ;

|| create strdev   0 , string-vectors ,

: z[  buf+  op-handle @ strout-push  strdev op-handle ! ;
: z]  0 emit  str  strout-pop op-handle !  buf- ;
: s[  z[ ;
: s]  z] wcount 1 - ;