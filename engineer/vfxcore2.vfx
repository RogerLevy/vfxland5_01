'd' dp-char !

variable debug  debug on
optimising off \ DO NOT REMOVE
-idata \ DO NOT REMOVE

also substitutions definitions
create vfxland5 256 allot&erase
s" %idir%\.." expand vfxland5 place
only forth definitions

\ =============================================================================
\ VFXLand5 codebase-wide language extensions
\ =============================================================================

include %idir%/misc.vfx           \ Miscellaneous utility words / core extensions
include %idir%/scope.vfx          \ Per-file public/private words; search order stack
include %idir%/fixed.vfx          \ 16.16 fixed-point math
include %idir%/format.vfx         \ Printf-style string formatting

include %idir%/nib2.vfx           \ NIBS (Nib 2.0) OOP system core
include %idir%/nib2-tools.vfx     \ NIBS introspection tools
include %idir%/nib2-compact.vfx   \ Compact class syntax parser (c:)

include %idir%/debug/oversight.vfx     \ Contract-based validation system
include %idir%/debug/core-checks.vfx   \ Core Forth word safety validations
include %idir%/checks.vfx              \ NIBS object validations

include %idir%/array2.vfx         \ NIBS arrays

include %idir%/dictionary.vfx     \ Key/value structures
include %idir%/fstools.vfx        \ Filesystem utilities
include %idir%/../lib/lstring.vfx \ Cell-counted strings
include %idir%/gamemath.vfx       \ 2D vectors and game math
include %idir%/strout.vfx         \ Capture console output

\ =============================================================================
\ Allegro bindings and utilities
\ =============================================================================

Target_386_Windows [if]
    \ debug @ [if]
    \ For now, we always load the debug version because 
    \ I forgot that we have to rebuild engineer.exe in order 
    \ to generate a turnkey without all the debugging-only stuff
    \ and I don't have the time to rework the turnkey system.
        LIBRARY: allegro_monolith-debug-5.2.dll
        allegro_monolith-debug-5.2.dll 0= 
            s" Allegro failed to load" .abort
    \ [else]
    \     LIBRARY: allegro_monolith-5.2.dll
    \     allegro_monolith-5.2.dll 0= 
    \         s" Allegro failed to load" .abort
    \ [then]
    -1 constant allegro?
[else]
    ." ALERT: Allegro 5 and dependents not available; Non-Windows bindings not yet implemented!" cr
[then]

[defined] allegro? [if]
    require %idir%/allegro-5.2.10.vfx  \ Allegro 5 library bindings
    require %idir%/al-utils.vfx       \ Display, window, and input state management
    require %idir%/keys.vfx           \ Keyboard key constants
    require %idir%/each-file.vfx      \ Directory iteration utilities
[then]
