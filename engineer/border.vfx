\ =============================================================================
\ TV
\ =============================================================================

|| : z ( - n ) zoom @ ;

: refit ( - )  \ find biggest integer scaling that fits display
    monw monh 2s>f f/
    appw apph 2s>f f/
    f> if
        monh apph /
    else
        monw appw /
    then
    zoom ! ;

: fs-w  appw z * ;
: fs-h  apph z * ;
: border-xy  monw 2 / monh 2 / fs-w 2 / fs-h 2 / 2- ;
: tv-xy  border-xy `` 2 z * dup `` 2- ;
: tv-xy2  border-xy `` 2 z * dup `` 2+ fs-w fs-h 2+ ;

: clip-screen ( - )
    border-xy fs-w fs-h al_set_clipping_rectangle ;

: border ( - )
    identity
    0 0 winw winh al_set_clipping_rectangle
    cls

    tv-xy 2s>f `` tv-xy2 2s>f ``
        0.25e 0.25e 0.25e 1e ```` al_draw_filled_rectangle

    6e f>ds >r
    border-xy 2s>f `` fs-w 1 + fs-h 1 + border-xy 2+ 2s>f ``
        0e 0e 0e 1e ```` r> ` al_draw_rectangle
    
    border-xy 2s>f `` z z 2s>f `` 0e ` transform
    clip-screen ;

: ?border
    identity 
    fullscreen? if
        refit border
    else
        0e 0e z s>f fdup 0e transform
    then ; 

: draw-tv ( xt - ) 
    zoom @ >r ?border execute r> zoom ! ;
