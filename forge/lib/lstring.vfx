\ ------------------------------------------------------------------------------
\ Cell-counted strings
\ ------------------------------------------------------------------------------

redef : lcount ( lstr - addr len )
    dup cell+ swap @ ;

: lplace ( addr len lstr - )
    2dup ! cell+ swap move ;

redef : lappend ( addr len lstr - )
    >r
    r@ cell+ r@ @ +  ( addr len dest )
    over >r swap move r>
    r@ @ + r> ! ;

: lslurp ( fn-a fn-len - l$ )
    here -rot  2dup fsize , file, ;

: *lstring ( a len - lstr )
    here -rot  dup cell+ allot here lplace ;

redef : l$,  ( a len - )
    *lstring drop ;

: l$@+ ( a - a' l$ len - )
    lcount 2dup + -rot ;