\ =============================================================================
\ Polled input
\ =============================================================================

redef : al_key_down \ fix bug in 5.2.10.1
    al_key_down 0<> 1 and ;
: held? ( n - flag )  kbs0 swap al_key_down 0<> ;
: kdelta ( - n )  dup kbs0 swap al_key_down kbs1 rot al_key_down - ;
: pressed? ( n - flag )  kdelta 1 = ;
: letgo? ( n - flag )  kdelta -1 = ;

\ =============================================================================
\ Event handling
\ =============================================================================

create the-event /ALLEGRO_EVENT allot&erase
: happened? ( n - f ) the-event ALLEGRO_EVENT.type @ = ;
: the-char ( - n ) the-event KEYBOARD_EVENT.unichar @ ;
: the-key ( - n ) the-event KEYBOARD_EVENT.keycode @ ;
: the-wheel ( - n ) the-event MOUSE_EVENT.dz @ ;
: the-mouse ( - n ) the-event MOUSE_EVENT.x 2@ ; 
: the-walt ( - n ) the-event MOUSE_EVENT.dx 2@ ; 
: the-mbutton ( - n ) the-event MOUSE_EVENT.button @ ;

\ =============================================================================
\ Keyboard state control
\ =============================================================================

|| create kbs2  /ALLEGRO_KEYBOARD_STATE allot
: save-kb  kbs0 kbs2 /ALLEGRO_KEYBOARD_STATE move ;
: erase-kb  kbs0 al_clear_keyboard_state ;
: restore-kb  kbs2 kbs0 /ALLEGRO_KEYBOARD_STATE move ;
: -keys  reset-keyboard ;
