\ ------------------------------------------------------------------------------
\ Cell-counted strings
\ ------------------------------------------------------------------------------

redef : wcount ( wstr - addr len )
    dup cell+ swap @ ;

: wplace ( addr len wstr - )
    2dup ! cell+ swap move ;

redef : wappend ( addr len wstr - )
    >r
    r@ cell+ r@ @ +  ( addr len dest )
    over >r swap move r>
    r@ @ + r> ! ;

: wslurp ( fn-a fn-len - w$ )
    here -rot  2dup fsize , file, ;

: *wstring ( a len - wstr )
    here -rot  dup cell+ allot here wplace ;

redef : w$,  ( a len - )
    *wstring drop ;

: w$@+ ( a - a' w$ len - )
    wcount 2dup + -rot ;